import click
from cthulhu_src.actions.forecast_backtest import run as run_cmd


@click.command()
@click.option("--prices", required=True, help="Список цен через запятую")
@click.option("--horizon", default=5, type=int, help="Горизонт прогнозирования (в минутах)")
@click.option("--lookback", default=60, type=int, help="Окно для анализа исторических данных")
@click.option(
    "--minutes-back",
    default=120,
    type=int,
    help="Сколько минут назад симулировать сделку",
)
@click.pass_context
def forecast_backtest(
    ctx, prices: str, horizon: int, lookback: int, minutes_back: int
) -> None:
    """
    Проверить прибыльность сделки, совершенной в прошлом.
    
    Эта команда симулирует торговую стратегию на исторических данных:
    
    **Как работает:**
    1. Берет данные из прошлого (minutes_back минут назад)
    2. Делает прогноз на horizon минут вперед
    3. Симулирует покупку/продажу на основе прогноза
    4. Рассчитывает прибыль/убыток
    
    **Параметры:**
    - prices: Исторические цены через запятую
    - horizon: На сколько минут вперед делать прогноз
    - lookback: Сколько исторических точек использовать
    - minutes-back: В какой момент прошлого симулировать сделку
    
    **Примеры:**
        python -m cthulhu_src.main forecast-backtest --prices 100,101,102,103 --horizon 5
        python -m cthulhu_src.main forecast-backtest --prices 100,101,102,103 --minutes-back 180
        python -m cthulhu_src.main forecast-backtest --prices 100,101,102,103 --lookback 30
    """
    run_cmd(ctx, prices, horizon, lookback, minutes_back)
