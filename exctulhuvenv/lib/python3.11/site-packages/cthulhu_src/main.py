#!/usr/bin/env python3
import sys
import click

"""
    Endpoint to ExCthulhu
"""

from cthulhu_src.utils import logger

# import commands
from cthulhu_src.routes.config import config
from cthulhu_src.routes.find_txn import find
from cthulhu_src.routes.exchanges import exchanges
from cthulhu_src.routes.available_io import available_io
from cthulhu_src.routes.forecast import forecast
from cthulhu_src.routes.forecast_backtest import forecast_backtest
from cthulhu_src.routes.forecast_arbitrage import forecast_arbitrage
from cthulhu_src.routes.historical_data import historical_data
from cthulhu_src.routes.web_server import web


@click.group()
@click.pass_context
def cli(ctx):
    ctx.ensure_object(dict)


# include cli commands
cli.add_command(find)
cli.add_command(config)
cli.add_command(exchanges)
cli.add_command(available_io)
cli.add_command(forecast)
cli.add_command(forecast_backtest)
cli.add_command(historical_data)
cli.add_command(forecast_arbitrage)
cli.add_command(web)


def main():
    """
    Before command routing initialize global objects.
    :return: int - exit status
    """
    debug = False
    if "--debug" in sys.argv:
        sys.argv.remove("--debug")
        logger.init(debug=True)
        debug = True
    else:
        logger.init()

    sys.exit(cli(obj={"debug": debug}))


if __name__ == "__main__":
    main()
